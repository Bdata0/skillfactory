# Задание 2.1

Для каких из этих задач оптимизации можно применять метод Лагранжа? (целевая функция дифференцируема)

- Для задач, где функции ограничений дифференцируемы
- Для задач, где ограничения заданы в виде $a \leq x \leq b$

# Задание 2.2

Найдите квадрат расстояния от точки $(2;1)$ до прямой $\xi_1+\xi_2=1$ с помощью метода Лагранжа.

В данно случае задача оптимизации выглядит так:

$$
\min_{\xi_1+\xi_2-1=0}(\xi_1-\xi_{10})^2 + (\xi_2-\xi_{20})^2
$$

Запишем уравнение прямой на плоскости в общем виде:

$$
A\xi_1+B\xi_2+C=0
$$

В нашем случае это $\xi_1+\xi_2-1=0$.

Запишем уравнение квадрата расстояния от точки $(\xi_{10},\xi_{20})$ до произвольной точки $(\xi_1,\xi_2)$:

$$
\rho^2 = (\xi_1-\xi_{10})^2 + (\xi_2-\xi_{20})^2 = (\xi_1-2)^2 + (\xi_2-1)^2
$$

Тогда уравнение Лагранжа для нашей задачи:

$$
L = (\xi_1-\xi_{10})^2 + (\xi_2-\xi_{20})^2 + \lambda(A\xi_1+B\xi_2+C) = (\xi_1-2)^2 + (\xi_2-1)^2 + \lambda(\xi_1+\xi_2-1)
$$

Запишем частные производные:

$$
\begin{cases}
\dfrac{\partial L(\xi_1,\xi_2,\lambda)}{\partial \xi_1} = 2\xi_1 - 2\xi_{10} + A\lambda = 2\xi_1 - 4 + \lambda\\
\dfrac{\partial L(\xi_1,\xi_2, \lambda)}{\partial \xi_2} = 2\xi_2 - 2\xi_{20} + B\lambda = 2\xi_2 - 2 + \lambda\\
\dfrac{\partial L(\xi_1,\xi_2, \lambda)}{\partial \lambda} = A\xi_1 + B\xi_2 + C = \xi_1 + \xi_2 - 1
\end{cases}
$$

Запишем СЛАУ в матричном виде:

$$
\left(\begin{array}{rrr|r}
   2 & 0 & 1 & 4\\
   0 & 2 & 1 & 2\\
   1 & 1 & 0 & 1
\end{array}\right)
=
\left(\begin{array}{rrr|r}
   1 & 0 & 0 & 1\\
   0 & 0 & 1 & 2\\
   0 & 1 & 0 & 0
\end{array}\right)
$$

Таким образом, получаем:

$\xi_1 = 1$, $\xi_2 = 0$, $\lambda = 2$

Подставим в уравнение Лагранжа:

$$
L = (\xi_1-2)^2 + (\xi_2-1)^2 + \lambda(\xi_1+\xi_2-1) = 1^2 + (-1)^2 + 2(1+0-1) = 2
$$

Ответ: $\rho^2 = 2$

# Задание 2.3

Прямоугольный параллелепипед имеет объем 1$\text{м}^3$. Какова минимальная площадь его поверхности?

В данном случае нам нужно решить задачу:
    
$$
\min_{\xi_1\xi_2\xi_3 = 1}{2(\xi_1\xi_2+\xi_2\xi_3+\xi_1\xi_3)} = \min_{V = 1}{2\bigg(\xi_1\xi_2 + \dfrac{V}{\xi_1} + \dfrac{V}{\xi_2}\bigg)}
$$

Запишем уравнение лагранжа:

$$
L(\xi_1, \xi_2, \lambda) = 2\bigg(\xi_1\xi_2 + \dfrac{V}{\xi_1} + \dfrac{V}{\xi_2}\bigg) + \lambda(V-1)
$$

Запишем частные производные:

$$
\begin{cases}
\dfrac{\partial L(\xi_1, \xi_2, \lambda)}{\partial \xi_1} = 2\bigg(\xi_2 - \dfrac{V}{\xi_1^2}\bigg)\\
\dfrac{\partial L(\xi_1, \xi_2, \lambda)}{\partial \xi_2} = 2\bigg(\xi_1 - \dfrac{V}{\xi_2^2}\bigg)\\
\dfrac{\partial L(\xi_1, \xi_2, \xi_3, \lambda)}{\partial \lambda} = V - 1
\end{cases}
$$

Подставим в формулу $\xi_2 = \dfrac{V}{\xi_1\xi_3}$ и $\xi_1 = \dfrac{V}{\xi_2\xi_3}$. Получим:

$$
\begin{cases}
\xi_1 = \xi_3\\
\xi_2 = \xi_3\\
\xi_3^3 = 1
\end{cases}
$$

Отсюда 

$\xi_1 = 1$, $\xi_2 = 1$, $\xi_3 = 1$

Таким образом,

$$
S_\text{min} = 2(\xi_1\xi_2+\xi_2\xi_3+\xi_1\xi_3) = 6
$$

Ответ: $S_\text{min} = 6$

# Задача 3.1

Какие из этих ограничений можно свести к ограничениям равенства?

$\sin{x}\geq 0.5$

$x^2\leq0$

$\cos{x}\leq\sin{x}$

$x+y\leq x-y$

# Задача 3.2

Сколько переменных будет у функции Лагранжа этой задачи:

$\min\limits_{5\leq x\leq 8\\x+y=2}{x^2+2xy+y^2}$

Запишем функцию Лагранжа

$$
L = x^2 + 2xy + y^2 + \lambda_1(x+\tilde{x}^2) + \lambda_2(x+y-2)
$$

Ответ: 5

# Задача 3.3

На стороне $\textrm{BC}$ равностороннего треугольника $\textrm{ABC}$ найти точку $\textrm{E}$ такую, для которой параллелограмм $\textrm{ADEF}$, у которого точки $\textrm{D}$ и $\textrm{F}$ лежат соответственно на сторонах $\textrm{AB}$ и $\textrm{AC}$, имеет наибольшую площадь. Сторона треугольника равна $\textrm{1}$. Чему равна эта площадь c точностью до сотых?

В силу подобия треугольников $\textrm{ABC}$M, $\textrm{DBE}$, $\textrm{FEC}$, $\textrm{EFD}$ и $\textrm{ADF}$, получаем:

$$
\begin{cases}
\textrm{AF} = \textrm{BE}\\
\textrm{AD} = \textrm{EC}
\end{cases}
$$

Учитывая, что $\textrm{CB} = \textrm{CE} + \textrm{EB}$, получим

$$
\textrm{AD} = \textrm{BC} - \textrm{AF}
$$

Так как площадь равна удвоенному скалярному произведению двух соседних сторон параллелограмма: 

$$
S = 2(\vec{\xi_1},\vec{\xi_2}) = 2(\vec{\textrm{AD}},\vec{\textrm{AF}}) =2\sin{(\widehat{\vec{\textrm{AD}},\vec{\textrm{AF}}})}|\vec{\textrm{AD}}||\vec{\textrm{AF}}|
$$

Обозначим $\textrm{AF} = \xi$, тогда $\textrm{AD} = \textrm{BC} - \xi$, тогда

$$
S = 2\sin{(\widehat{\vec{\textrm{AD}},\vec{\textrm{AF}}})}(|\vec{\textrm{BC}}| - |\vec{\textrm{AF}}|)|\vec{\textrm{AF}}| = \sqrt{3}(1-\xi)\xi
$$

Посчитаем производную

$$
\dfrac{dS}{d\xi} = \sqrt{3}(1-2\xi)
$$

Приравняв ее к нулю, получим:

$$
\xi_\min = \dfrac{1}{2}
$$

Отсюда 

$$
S_\min = \dfrac{\sqrt{3}}{4}
$$

Ответ: $S_\min \approx 0.22$

# Задание 4.1

Какие из этих функций могут быть целевыми в задаче линейного программирования?

$2x_1 + x_2 + 2$

# Задание 4.2

Можно ли использовать метод Лагранжа для задач линейного программирования?

Ответ: Всегда можно.

# Задание 4.3

Какие числа должны быть целыми в задаче ЦЛП?

Ответ: Переменные.

# Задание 4.4

Сколько будет ограничений в задаче о назначениях на 4 работы и 4 исполнителя, не считая ограничение $0\leq x_{ij}\leq1$?

Ответ: 8.

# Задание 5.1

Составьте оптимальный план перевозок, со Склада № 1 и Склада № 2, в три торговых центра, с учётом тарифов, запасов и потребностей, которые указаны в таблице:

| |ТЦ1 (110 шт)|ТЦ2 (150 шт)|ТЦ3 (140 шт)|
|-|------------|------------|------------|
|Склад №1 (180 шт)|2 у.е.|5 у.е|3 у.е|
|Склад №2 (220 шт)|7 у.е.|7 у.е.|6 у.е.|

Сформулируйте задачу, как задачу линейного программирования, и решите её любым способом (желательно программным).

В ответ запишите минимальную суммарную стоимость поставки (с точностью до целых).

Составим задачу:

$$
\min{\textrm{r}^\textrm{T}x},
$$
где $\textrm{r}$ - вектор тарифов, $x$ - вектор количества закупок по тарифу

Запишем условия задачи:

$$
\begin{cases}
x \geq 0\\
\sum\limits_{i=0}^2{x_i} \leq 180\\
\sum\limits_{i=3}^5{x_i} \leq 220\\
x_i+x_{i+3} = a_i,\ \ \ \ i \in \{0,1,2\},\ \ \ \ a = \{110, 150, 140\}
\end{cases}
$$

Решим, используя библиотеку cvxpy:


```python
import cvxpy
import numpy as np

# Запишем тарифы, запас и нужды
r = array([[2,5,3],[7,7,6]])
stock = np.array([180,220])
need = np.array([110,150,140])

# Объявим переменную, которую будем оптимизировать
x = cvxpy.Variable(shape=np.shape(r), integer = True)
total_value = cvxpy.sum(cvxpy.multiply(r, x))

# Создадим строки из единиц размеров матрицы
col_n_e = np.array([1]*np.shape(r)[0])
row_n_e = np.array([1]*np.shape(r)[1])

# Запишем условия
x_positive = (x >= 0)
sum_cols = (col_n_e @ x == need)
sum_rows = (x @ row_n_e.T == stock)

constraint = [x_positive, sum_cols, sum_rows]

# Создадим и решим задачу оптимизации
problem = cvxpy.Problem(cvxpy.Minimize(total_value), constraints=constraint)
print('Ответ: {}'.format(round(problem.solve())))
```

    Ответ: 1900


# Задание 5.2

Решите задачу о назначениях

У вас есть $n$ задач и $n$ человек, которые могут их сделать. Каждая задача должна быть сделана одним человеком и каждый должен сделать ровно одну задачу. У человека $i$ задача $j$ будет стоить $c_{ij}$. Вам нужно сделать все задачи как можно дешевле.

|             | Задачи |      |      |      |      |      |
|-------------|--------|------|------|------|------|------|
| Исполнители |        | 1    | 2    | 3    | 4    | 5    |
|             | 1      | 1000 | 12   | 10   | 19   | 8    |
|             | 2      | 12   | 1000 | 3    | 7    | 2    |
|             | 3      | 10   | 3    | 1000 | 6    | 20   |
|             | 4      | 19   | 7    | 6    | 1000 | 4    |
|             | 5      | 8    | 2    | 20   | 4    | 1000 |

В ответ запишите минимальную стоимость.

Составим задачу:

$$
\min{\textrm{c}^\textrm{T}x},
$$
где $\textrm{c}$ и $x$ составляют матрицу цен задач в одномерном виде

Запишем условия задачи:

$$
\begin{cases}
x \geq 0\\
x \leq 1\\
\forall i \sum\limits_{j=0}^4{x_{ij}} = 1\\
\forall j \sum\limits_{i=0}^4{x_{ij}} = 1\\
\end{cases}
$$

Решим, используя библиотеку cvxpy:


```python
import cvxpy
import numpy as np

# Запишем стоимости задач в построчном порядке
c = np.array([[1000,12,10,19,8],
              [12,1000,3,7,2],
              [10,3,1000,6,20],
              [19,7,6,1000,4],
              [8,2,20,4,1000]])

# Объявим переменную, которую будем оптимизировать
x = cvxpy.Variable(shape=np.shape(c), integer = True)
total_value = cvxpy.sum(cvxpy.multiply(c, x))

# Создадим строки из единиц размеров матрицы
col_n_e = np.array([1]*np.shape(c)[0])
row_n_e = np.array([1]*np.shape(c)[1])

# Запишем условия
x_positive = (x >= 0)
x_10 = (x <= 1)
sum_cols = (col_n_e @ x == row_n_e)
sum_rows = (x @ row_n_e.T == col_n_e)

constraint = [x_positive, x_10, sum_cols, sum_rows]

# Создадим и решим задачу оптимизации
problem = cvxpy.Problem(cvxpy.Minimize(total_value), constraints=constraint)
print('Ответ: {}'.format(round(problem.solve())))
```

    Ответ: 32


# Задача 5.3

Необходимо найти кратчайший маршрут из точки $\textrm{A}$, который проходит через все другие точки и возвращается в $\textrm{A}$.

![Рисунок к задаче 5.3](task53.png)

Сформулируйте эту задачу как задачу ЦЛП и решите её.

В ответ запишите длину кратчайшего пути:

Введем формально $n+1$ город, расположенный там же, где и первый город, т.е. расстояния от $n+1$ города до любого другого, отличного от первого, равны расстояниям от первого города. При этом, если из первого города можно лишь выйти, то в $n+1$ город можно лишь придти.

Сформулируем задачу:

$$
\min{\rho^\textrm{T}x},
$$

где $\rho$ - вектор весов (расстояний), $x$ - вектор использования пути

Таким образом, сформулируем условия задачи:

$$
\begin{cases}
\sum\limits_{i=0}^nx_{ij} = 1,\ \ \ \ i\neq j\\
\sum\limits_{j=0}^nx_{ij} = 1,\ \ \ \ j\neq i\\
u_i-u_j+nx_{ij} \leq n-1,\ \ \ \ j \in \{2,\dots,n+1\},\ \ \ \ i\neq{j}\\
i = 1 \rightarrow j \neq n+1\\
0\leq u_i\leq n\\
x_{in+1}=x_{i1},\ \ \ \ i\in\{2,\dots,n\}
\end{cases}
$$

Составим матрицу длин путей:

$$
\begin{pmatrix}
0 & 12 & 10 & 19 & 8\\
12 & 0 & 3 & 7 & 2\\
10 & 3 & 0 & 6 & 20\\
19 & 7 & 6 & 0 & 4\\
8 & 2 & 20 & 4 & 0
\end{pmatrix}
$$

Она же с добавлением $n+1$ города:

## По факту пока не решена


```python
import cvxpy
from numpy import array

# Запишем стоимости задач в построчном порядке
r = array([0, 12, 10, 19, 8,
           12, 0, 3, 7, 2,
           10, 3, 0, 6, 20,
           19, 7, 6, 0, 4,
           8, 2, 20, 4, 0,])
r[r==0] = 1000
n = len(r)
shp = int(n**0.5)

# Объявим переменную, которую будем оптимизировать
x = cvxpy.Variable(shape=n, integer = True)
total_value = r @ x

# Запишем условия
x_positive = (x >= 0)
x_10 = (x <= 1)
task_per_people = [sum([x[i] for i in range(shp*j, shp*j + shp)]) == 1 for j in range(shp)]
people_per_task = [sum([x[i] for i in range(j, n, shp)]) == 1 for j in range(shp)]

constraint = [x_positive, x_10] + task_per_people + people_per_task

# Создадим и решим задачу оптимизации
problem = cvxpy.Problem(cvxpy.Minimize(total_value), constraints=constraint)
print('Ответ: {}'.format(round(problem.solve())))
```

    Ответ: 32


# Задание 6.1

Что происходит при уменьшении темпа обучения градиентного спуска?

Ответ: Скорость сходимости снижается верно.

# Задание 6.2

Сможет ли градиентный спуск найти минимум функции $y=|x|$ ?

Ответ: не сможет.

# Задание 6.3

Зачем начинать градиентный спуск с нескольких точек?

Ответ: Больше шанс сойтись в глобальный минимум.

# Задание 6.4

Что из этого нужно уметь вычислять для программной реализации градиентного спуска?

Ответ: Градиент функции в точке.

# Задание 6.5

Напишите следующую точку градиентного спуска для функции $f(x, y, z) = 2x^2 -4xz + 4y^2 - 8yz + 9z^2 +4x + 8y - 20z$

Посчитаем градиент функции:

$$
\vec\nabla f(x, y, z) = 
\begin{pmatrix}
4x - 4z +4\\
8y - 8z +8\\
-4x -8y +18z -20
\end{pmatrix}
$$

В точке $(0,0,0)$ градиент:

$$
\vec\nabla f(0, 0, 0) = 
\begin{pmatrix}
4\\
8\\
-20
\end{pmatrix}
$$

Тогда следущая точка:

$$
\begin{pmatrix}
x_1\\
y_1\\
z_1\\
\end{pmatrix}
=
\begin{pmatrix}
x_0\\
y_0\\
z_0
\end{pmatrix}
-
\gamma\vec\nabla f(x_0, y_0, z_0)
=
\begin{pmatrix}
0\\
0\\
0
\end{pmatrix}
-
\dfrac{1}{4}
\begin{pmatrix}
4\\
8\\
-20
\end{pmatrix}
=
\begin{pmatrix}
-1\\
-2\\
5
\end{pmatrix}
$$

Ответ: $(-1,-2,5)$

# Задание 7.1

Найдите градиентным спуском минимум функции $f(x,y) = 2x^2-4xy+y^4+2$

Решим, используя scipy.optimize.minimize:


```python
# Объявим функцию:
def f(x,y):
    return 2*x**2 - 4*x*y + y**4 + 2

# Запустим градиентный спуск
from scipy.optimize import minimize
print('Ответ: {}'.format(round(minimize(lambda x: f(*x), x0=(5,0))['fun'])))
```

    Ответ: 1


# Задание 7.2

Обучите линейную регрессию из Задачи 3.7.3 при помощи градиентного спуска. Чему равно оптимальное значение $L^2$?

Функция выглядит так:

$$
L^2 = (2.1 -\omega_0 - \omega_1)^2 + (2.9 - \omega_0 - 3\omega_1)^2 + (4.1 - \omega_0 - 5\omega_1)^2
$$

Решим задачу:


```python
# Объявим функцию:
def L2(w0,w1):
    return (2.1-w0-w1)**2 + (2.9-w0-3*w1)**2 + (4.1-w0-5*w1)**2

# Запустим градиентный спуск
from scipy.optimize import minimize
print('Ответ: {}'.format(round(minimize(lambda x: L2(*x), x0=(0,0))['fun'])))
```

    Ответ: 0


# Задание 7.3

Найдите градиентным спуском минимум функции $f(x,y,z) = x^3-2x^2+y^2+z^2-2xy+xz-yz+3z$.


```python
# Объявим функцию:
def f(x,y,z):
    return x**3-2*x**2+y**2+z**2-2*x*y+x*z-y*z+3*z

# Запустим градиентный спуск
from scipy.optimize import minimize
print('Ответ: {}'.format(round(minimize(lambda x: f(*x), x0=(0,0,0))['fun'])))
```

    Ответ: -7


# Задание 8.1

За счёт чего градиентный спуск с momentum лучше работает?

Ответ: Использует информацию с предыдущих шагов.

# Задание 8.2

Напишите следующую точку градиентного спуска с momentum для функции

$f(x,y,z) = 2x^2 - 4xz + 4y^2 - 8yz + 9z^2 + 4x + 8y - 20z$, если текущая точка - $(1,2,-5)$, перед ней была $(0,0,0)$, $\gamma=0.25$, $\alpha=1$.

Посчитаем градиент функции в произвольной точке:

$$
\vec\nabla f(x, y, z) = 
\begin{pmatrix}
4x - 4z +4\\
8y - 8z +8\\
-4x -8y +18z -20
\end{pmatrix}
$$

В точке $(1,2,-5)$ градиент:


$$
\vec\nabla f(1, 2, -5) = 
\begin{pmatrix}
28\\
64\\
-130
\end{pmatrix}
$$

Таким образом, следущая точка:

$$
\begin{pmatrix}
x_2\\
y_2\\
z_2\\
\end{pmatrix}
=
\begin{pmatrix}
x_1\\
y_1\\
z_1
\end{pmatrix}
-
\gamma\vec\nabla f(x_1, y_1, z_1)
+
\alpha\begin{pmatrix}
x_1\\
y_1\\
z_1\\
\end{pmatrix}
-
\alpha\begin{pmatrix}
x_0\\
y_0\\
z_0\\
\end{pmatrix}
=
\begin{pmatrix}
1\\
2\\
-5
\end{pmatrix}
-
\dfrac{1}{4}
\begin{pmatrix}
28\\
64\\
-130
\end{pmatrix}
+
\begin{pmatrix}
1\\
2\\
-5
\end{pmatrix}
=
\begin{pmatrix}
-5\\
-12\\
22.5
\end{pmatrix}
$$


Ответ: $(-5,-12,22.5)$

# Задание 9.1

На рисунке изображён график функции $f(x)$. Какая точка будет следующей после $x_0$ в методе Ньютона для поиска решения уравнения $f(x) =0$?

![График к заданию 9.1](task91.png)

Ответ: $x_2$

# Задание 9.2

Что из этого является минусами метода Ньютона относительно градиентного спуска?

Методу Ньютона нужно чтобы функция была дважды дифференцируема

Обычно долго считать обратную матрицу Гессе

# Задание 9.3

Сможет ли метод Ньютона найти минимум функции $y=|x|$?

Ответ: нет.

# Задание 9.4

Найдите следующий шаг метода Ньютона для функции $f(x,y) = x^2 + xy - 2x + 3y - 1$, если текущая точка $(0,1)$.

Посчитаем обратный Гессиан функции:

$$
H^{-1}(f(x,y)) = 
\begin{pmatrix}
\dfrac{\partial^2 f(x,y)}{\partial x^2} & \dfrac{\partial^2 f(x,y)}{\partial x \partial y}\\
\dfrac{\partial^2 f(x,y)}{\partial y \partial x} &
\dfrac{\partial^2 f(x,y)}{\partial y^2}
\end{pmatrix}^{-1}
=
\begin{pmatrix}
2 & 1\\
1 & 0
\end{pmatrix}^{-1}
=
\begin{pmatrix}
0 & 1\\
1 & -2
\end{pmatrix}
$$

Посчитаем градиент функции:

$$
\vec\nabla f(x,y) = 
\begin{pmatrix}
2x + y - 2\\
x + 3
\end{pmatrix}
$$

Тогда следущая точка:

$$
\begin{pmatrix}
x_1\\
y_1
\end{pmatrix}
=
\begin{pmatrix}
x_0\\
y_0
\end{pmatrix}
-
H^{-1}(f(x_0,y_0))\vec\nabla f(x_0,y_0)
=
\begin{pmatrix}
0\\
1
\end{pmatrix}
-
\begin{pmatrix}
0 & 1\\
1 & -2
\end{pmatrix}
\begin{pmatrix}
-1\\
3
\end{pmatrix}
=
\begin{pmatrix}
-3\\
8
\end{pmatrix}
$$

# Задание 10.1

Укажите все верные утверждения.

Ответ: Метод отжига можно применять, даже если x принимает только натуральные значения.

# Задание 10.2

Что из этого может подойти как $c_k$ для метода отжига?

$$
c_k = \frac{1}{k}\\
c_k = e^{-k}
$$

# Задание 11.1

Какой алгоритм лучше использовать при минимизации функции $x^4-2x^3y+3x^2y^2-4x^2+y$ при условии, что $x+y<20$?

Ответ: Метод множителей Лагранжа.

# Задание 11.2

Какой алгоритм лучше использовать при минимизации функции потерь линейной регрессии на $1000$ параметров?

Ответ: Градиентный спуск.

# Задание 11.3

Какой алгоритм лучше использовать, чтобы найти минимум функции $(5-x)^2 + 20(y-x^2)^2$?

Ответ: Метод Ньютона.

# Задание 11.4

Какой алгоритм лучше использовать при минимизации функции $2x^2-4xz+4y^2-8yz+9z^2+4x+8y-20z$, если $x$, $y$, $z$ натуральные и меньше $1000$?

Ответ: Метод отжига.
